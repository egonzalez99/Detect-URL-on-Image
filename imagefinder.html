<!DOCTYPE html>
<html lang="en">
<head>
    <title>Steganography</title>
</head>
<body>
    <input type="file" id="imageInput">
    <textarea id="textToHide" placeholder="Enter text to hide"></textarea>
    <button onclick="process('hide')">Hide Text</button>
    <button onclick="process('extract')">Extract Text</button>
    <script>
        function process(action) {
            const imageInput = document.getElementById("imageInput");
            const textToHide = document.getElementById("textToHide").value;
            const image = new Image();
            image.onload = function() {
                const canvas = document.createElement("canvas");
                const ctx = canvas.getContext("2d");
                canvas.width = image.width;
                canvas.height = image.height;
                ctx.drawImage(image, 0, 0);
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                let binaryText = "";
                if (action === 'hide') {
                    binaryText = textToBinary(textToHide);
                    if (binaryText.length > imageData.data.length * 8) {
                        alert("Text too long to be encoded");
                        return;
                    }
                }

                let dataIndex = 0;
                for (let i = 0; i < imageData.data.length; i += 4) {
                    if (dataIndex < binaryText.length) {
                        imageData.data[i] &= 0xFE;
                        imageData.data[i] |= binaryText[dataIndex++];
                    }
                    if (dataIndex < binaryText.length) {
                        imageData.data[i+1] &= 0xFE;
                        imageData.data[i+1] |= binaryText[dataIndex++];
                    }
                    if (dataIndex < binaryText.length) {
                        imageData.data[i+2] &= 0xFE;
                        imageData.data[i+2] |= binaryText[dataIndex++];
                    } else if (action === 'extract') {
                        binaryText += (imageData.data[i] & 1);
                        binaryText += (imageData.data[i+1] & 1);
                        binaryText += (imageData.data[i+2] & 1);
                    }
                }

                if (action === 'hide') {
                    ctx.putImageData(imageData, 0, 0);
                    const encodedImage = canvas.toDataURL();
                    const imgElement = document.createElement("img");
                    imgElement.src = encodedImage;
                    document.body.appendChild(imgElement);
                } else {
                    alert("Extracted text: " + binaryToText(binaryText));
                }
            };
            image.src = URL.createObjectURL(imageInput.files[0]);
        }

        function textToBinary(text) {
            let binary = "";
            for (let i = 0; i < text.length; i++) {
                const charCode = text.charCodeAt(i).toString(2);
                binary += "0".repeat(8 - charCode.length) + charCode;
            }
            return binary;
        }

        function binaryToText(binary) {
            let text = "";
            for (let i = 0; i < binary.length; i += 8) {
                text += String.fromCharCode(parseInt(binary.substr(i, 8), 2));
            }
            return text;
        }
    </script>
</body>
</html>